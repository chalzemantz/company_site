{"version":3,"file":"node-build.mjs","sources":["../../server/routes/demo.ts","../../server/routes/contact.ts","../../server/index.ts","../../server/node-build.ts"],"sourcesContent":["import { RequestHandler } from \"express\";\r\nimport { DemoResponse } from \"@shared/api\";\r\n\r\nexport const handleDemo: RequestHandler = (req, res) => {\r\n  const response: DemoResponse = {\r\n    message: \"Hello from Express server\",\r\n  };\r\n  res.status(200).json(response);\r\n};\r\n","import { RequestHandler } from \"express\";\r\nimport { z } from \"zod\";\r\nimport { Resend } from \"resend\";\r\nimport type { ContactFormData, ContactResponse } from \"@shared/api\";\r\n\r\n// Validation schema\r\nconst contactFormSchema = z.object({\r\n  name: z.string().min(1, \"Name is required\").trim(),\r\n  email: z.string().email(\"Invalid email address\"),\r\n  phone: z.string().optional(),\r\n  company: z.string().optional(),\r\n  message: z.string().min(1, \"Message is required\").trim(),\r\n});\r\n\r\nexport const handleContact: RequestHandler = async (req, res) => {\r\n  try {\r\n    // Initialize Resend client lazily to ensure API key is available\r\n    const apiKey = process.env.RESEND_API_KEY;\r\n    if (!apiKey) {\r\n      console.error(\"RESEND_API_KEY environment variable is not set\");\r\n      return res.status(500).json({\r\n        success: false,\r\n        message: \"Email service is not configured. Please try again later.\",\r\n      } as ContactResponse);\r\n    }\r\n\r\n    const resend = new Resend(apiKey);\r\n\r\n    // Ensure req.body is available and is an object\r\n    const body = typeof req.body === \"string\" ? JSON.parse(req.body) : req.body;\r\n\r\n    // Validate request body\r\n    const data = contactFormSchema.parse(body) as ContactFormData;\r\n\r\n    // Send email to admin\r\n    const adminEmailResult = await resend.emails.send({\r\n      from: \"noreply@ventechplus.xyz\",\r\n      to: \"admin@ventechplus.xyz\",\r\n      subject: `New Contact Form Submission from ${data.name}`,\r\n      html: `\r\n        <h2>New Contact Form Submission</h2>\r\n        <p><strong>Name:</strong> ${escapeHtml(data.name)}</p>\r\n        <p><strong>Email:</strong> ${escapeHtml(data.email)}</p>\r\n        ${data.phone ? `<p><strong>Phone:</strong> ${escapeHtml(data.phone)}</p>` : \"\"}\r\n        ${data.company ? `<p><strong>Company:</strong> ${escapeHtml(data.company)}</p>` : \"\"}\r\n        <h3>Message:</h3>\r\n        <p>${escapeHtml(data.message).replace(/\\n/g, \"<br>\")}</p>\r\n      `,\r\n    });\r\n\r\n    if (adminEmailResult.error) {\r\n      console.error(\"Failed to send admin email:\", adminEmailResult.error);\r\n      return res.status(500).json({\r\n        success: false,\r\n        message: \"Failed to send email. Please try again later.\",\r\n      } as ContactResponse);\r\n    }\r\n\r\n    // Send confirmation email to user\r\n    const userEmailResult = await resend.emails.send({\r\n      from: \"noreply@ventechplus.xyz\",\r\n      to: data.email,\r\n      subject: \"We received your message - BlackBugs Technologies\",\r\n      html: `\r\n        <h2>Thank You for Contacting Us!</h2>\r\n        <p>Hi ${escapeHtml(data.name)},</p>\r\n        <p>We received your message and appreciate you reaching out to BlackBugs Technologies.</p>\r\n        <p>Our team will review your inquiry and get back to you as soon as possible.</p>\r\n        <p>Best regards,<br>The BlackBugs Technologies Team</p>\r\n      `,\r\n    });\r\n\r\n    if (userEmailResult.error) {\r\n      console.error(\r\n        \"Failed to send confirmation email:\",\r\n        userEmailResult.error,\r\n      );\r\n      // Don't fail the response if confirmation email fails, as the admin email was sent successfully\r\n    }\r\n\r\n    return res.status(200).json({\r\n      success: true,\r\n      message:\r\n        \"Your message has been sent successfully. We'll get back to you soon!\",\r\n    } as ContactResponse);\r\n  } catch (error) {\r\n    // Handle validation errors\r\n    if (error instanceof z.ZodError) {\r\n      const firstError = error.errors[0];\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: firstError.message,\r\n      } as ContactResponse);\r\n    }\r\n\r\n    // Handle body stream errors\r\n    if (error instanceof Error && error.message.includes(\"body stream\")) {\r\n      console.error(\"Body stream error:\", error);\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: \"Invalid request format. Please try again.\",\r\n      } as ContactResponse);\r\n    }\r\n\r\n    // Handle JSON parse errors\r\n    if (error instanceof SyntaxError && \"body\" in error) {\r\n      console.error(\"JSON parse error:\", error);\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: \"Invalid JSON in request. Please try again.\",\r\n      } as ContactResponse);\r\n    }\r\n\r\n    // Handle other errors\r\n    console.error(\"Contact form error:\", error);\r\n    return res.status(500).json({\r\n      success: false,\r\n      message:\r\n        \"An error occurred while processing your request. Please try again later.\",\r\n    } as ContactResponse);\r\n  }\r\n};\r\n\r\n// Helper function to escape HTML special characters\r\nfunction escapeHtml(text: string): string {\r\n  const map: Record<string, string> = {\r\n    \"&\": \"&amp;\",\r\n    \"<\": \"&lt;\",\r\n    \">\": \"&gt;\",\r\n    '\"': \"&quot;\",\r\n    \"'\": \"&#039;\",\r\n  };\r\n  return text.replace(/[&<>\"']/g, (char) => map[char]);\r\n}\r\n","import \"dotenv/config\";\r\nimport express from \"express\";\r\nimport cors from \"cors\";\r\nimport { handleDemo } from \"./routes/demo\";\r\nimport { handleContact } from \"./routes/contact\";\r\n\r\nexport function createServer() {\r\n  const app = express();\r\n\r\n  // Middleware\r\n  app.use(cors());\r\n  app.use(express.json({ limit: \"10mb\" }));\r\n  app.use(express.urlencoded({ extended: true, limit: \"10mb\" }));\r\n\r\n  // Example API routes\r\n  app.get(\"/api/ping\", (_req, res) => {\r\n    const ping = process.env.PING_MESSAGE ?? \"ping\";\r\n    res.json({ message: ping });\r\n  });\r\n\r\n  app.get(\"/api/demo\", handleDemo);\r\n\r\n  // Contact form route\r\n  app.post(\"/api/contact\", handleContact);\r\n\r\n  return app;\r\n}\r\n","import path from \"path\";\r\nimport { createServer } from \"./index\";\r\nimport * as express from \"express\";\r\n\r\nconst app = createServer();\r\nconst port = process.env.PORT || 3000;\r\n\r\n// In production, serve the built SPA files\r\nconst __dirname = import.meta.dirname;\r\nconst distPath = path.join(__dirname, \"../spa\");\r\n\r\n// Serve static files\r\napp.use(express.static(distPath));\r\n\r\n// Handle React Router - serve index.html for all non-API routes\r\napp.get(\"*\", (req, res) => {\r\n  // Don't serve index.html for API routes\r\n  if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\r\n    return res.status(404).json({ error: \"API endpoint not found\" });\r\n  }\r\n\r\n  res.sendFile(path.join(distPath, \"index.html\"));\r\n});\r\n\r\napp.listen(port, () => {\r\n  console.log(`ðŸš€ Fusion Starter server running on port ${port}`);\r\n  console.log(`ðŸ“± Frontend: http://localhost:${port}`);\r\n  console.log(`ðŸ”§ API: http://localhost:${port}/api`);\r\n});\r\n\r\n// Graceful shutdown\r\nprocess.on(\"SIGTERM\", () => {\r\n  console.log(\"ðŸ›‘ Received SIGTERM, shutting down gracefully\");\r\n  process.exit(0);\r\n});\r\n\r\nprocess.on(\"SIGINT\", () => {\r\n  console.log(\"ðŸ›‘ Received SIGINT, shutting down gracefully\");\r\n  process.exit(0);\r\n});\r\n"],"names":["app","express","__dirname"],"mappings":"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"}